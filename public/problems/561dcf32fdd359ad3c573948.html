<link rel="stylesheet" href="http://st.codeforces.com/css/ttypography.css" type="text/css" charset="utf-8"><link rel="stylesheet" href="http://st.codeforces.com/css/problem-statement.css" type="text/css" charset="utf-8"><div class="problemindexholder" problemindex="C">
<div class="ttypography"><div class="problem-statement"><div class="header"><div class="title">Circling Round Treasures</div><div class="time-limit"><div class="property-title">time limit per test</div>1 second</div><div class="memory-limit"><div class="property-title">memory limit per test</div>256 megabytes</div><div class="input-file"><div class="property-title">input</div>standard input</div><div class="output-file"><div class="property-title">output</div>standard output</div></div><div><p>You have a map as a rectangle table. Each cell of the table is either an obstacle, or a treasure with a certain price, or a bomb, or an empty cell. Your initial position is also given to you.</p><p>You can go from one cell of the map to a side-adjacent one. At that, you are not allowed to go beyond the borders of the map, enter the cells with treasures, obstacles and bombs. To pick the treasures, you need to build a closed path (starting and ending in the starting cell). The closed path mustn&apos;t contain any cells with bombs inside. Let&apos;s assume that the sum of the treasures&apos; values that are located inside the closed path equals <span class="tex-span"><i>v</i></span>, and besides, you&apos;ve made <span class="tex-span"><i>k</i></span> single moves (from one cell to another) while you were going through the path, then such path brings you the profit of <span class="tex-span"><i>v</i>&#x2009;-&#x2009;<i>k</i></span> rubles.</p><p>Your task is to build a closed path that doesn&apos;t contain any bombs and brings maximum profit.</p><p>Note that the path can have self-intersections. In order to determine if a cell lies inside a path or not, use the following algorithm:</p><ol> <li> Assume that the table cells are points on the plane (the table cell on the intersection of the <span class="tex-span"><i>i</i></span>-th column and the <span class="tex-span"><i>j</i></span>-th row is point <span class="tex-span">(<i>i</i>,&#x2009;<i>j</i>)</span>). And the given path is a closed polyline that goes through these points. </li><li> You need to find out if the point <span class="tex-span"><i>p</i></span> of the table that is not crossed by the polyline lies inside the polyline. </li><li> Let&apos;s draw a ray that starts from point <span class="tex-span"><i>p</i></span> and does not intersect other points of the table (such ray must exist). </li><li> Let&apos;s count the number of segments of the polyline that intersect the painted ray. If this number is odd, we assume that point <span class="tex-span"><i>p</i></span> (and consequently, the table cell) lie inside the polyline (path). Otherwise, we assume that it lies outside. </li></ol></div><div class="input-specification"><div class="section-title">Input</div><p>The first line contains two integers <span class="tex-span"><i>n</i></span> and <span class="tex-span"><i>m</i></span> <span class="tex-span">(1&#x2009;&#x2264;&#x2009;<i>n</i>,&#x2009;<i>m</i>&#x2009;&#x2264;&#x2009;20)</span> &#x2014; the sizes of the table. Next <span class="tex-span"><i>n</i></span> lines each contains <span class="tex-span"><i>m</i></span> characters &#x2014; the description of the table. The description means the following:</p><ul> <li> character &quot;<span class="tex-font-style-tt">B</span>&quot; is a cell with a bomb; </li><li> character &quot;<span class="tex-font-style-tt">S</span>&quot; is the starting cell, you can assume that it&apos;s empty; </li><li> digit <span class="tex-span"><i>c</i></span> (<span class="tex-font-style-tt">1-8</span>) is treasure with index <span class="tex-span"><i>c</i></span>; </li><li> character &quot;<span class="tex-font-style-tt">.</span>&quot; is an empty cell; </li><li> character &quot;<span class="tex-font-style-tt">#</span>&quot; is an obstacle. </li></ul><p>Assume that the map has <span class="tex-span"><i>t</i></span> treasures. Next <span class="tex-span"><i>t</i></span> lines contain the prices of the treasures. The <span class="tex-span"><i>i</i></span>-th line contains the price of the treasure with index <span class="tex-span"><i>i</i></span>, <span class="tex-span"><i>v</i><sub class="lower-index"><i>i</i></sub></span> <span class="tex-span">(&#x2009;-&#x2009;200&#x2009;&#x2264;&#x2009;<i>v</i><sub class="lower-index"><i>i</i></sub>&#x2009;&#x2264;&#x2009;200)</span>. It is guaranteed that the treasures are numbered from 1 to <span class="tex-span"><i>t</i></span>. It is guaranteed that the map has not more than 8 objects in total. Objects are bombs and treasures. It is guaranteed that the map has exactly one character &quot;<span class="tex-font-style-tt">S</span>&quot;.</p></div><div class="output-specification"><div class="section-title">Output</div><p>Print a single integer &#x2014; the maximum possible profit you can get.</p></div><div class="sample-tests"><div class="section-title">Sample test(s)</div><div class="sample-test"><div class="input"><div class="title">Input</div><pre>4 4<br>....<br>.S1.<br>....<br>....<br>10<br></pre></div><div class="output"><div class="title">Output</div><pre>2<br></pre></div><div class="input"><div class="title">Input</div><pre>7 7<br>.......<br>.1###2.<br>.#...#.<br>.#.B.#.<br>.3...4.<br>..##...<br>......S<br>100<br>100<br>100<br>100<br></pre></div><div class="output"><div class="title">Output</div><pre>364<br></pre></div><div class="input"><div class="title">Input</div><pre>7 8<br>........<br>........<br>....1B..<br>.S......<br>....2...<br>3.......<br>........<br>100<br>-100<br>100<br></pre></div><div class="output"><div class="title">Output</div><pre>0<br></pre></div><div class="input"><div class="title">Input</div><pre>1 1<br>S<br></pre></div><div class="output"><div class="title">Output</div><pre>0<br></pre></div></div></div><div class="note"><div class="section-title">Note</div><p>In the first example the answer will look as follows.</p><center> <img class="tex-graphics" src="http://codeforces.com/predownloaded/59/6c/596ccdb6b38841d47c72e8c05bf00d9179e9b902.png"> </center><p>In the second example the answer will look as follows.</p><center> <img class="tex-graphics" src="http://codeforces.com/predownloaded/a1/a4/a1a4ce0aafeb516ebfad616e030eaf28306121ea.png"> </center><p>In the third example you cannot get profit.</p><p>In the fourth example you cannot get profit as you cannot construct a closed path with more than one cell.</p></div></div></div>
</div>